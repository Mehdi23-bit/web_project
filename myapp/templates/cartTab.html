<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/cart.css' %}">
    <title>Cart</title>
</head>
<body>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% include "header.html" %}
    
    <main>
        <section class="parallax-section" id="section2" style="background-image: url('{% static 'img/pexels37.jpg' %}');">
            <div class="overlay">
                <h1>My Cart</h1>
            </div>
        </section>

        <div class="cta-banner">
            <p>Review your selected items before proceeding to checkout. Adjust quantities or remove items as needed.</p>
        </div>

        <div class="cart-content">
            <!-- Product Listing on the Left -->
            <div class="cart-items">
                {% if cart.get_prod.items %}
                {% for key, item in cart.get_prod.items %}
                <div class="cart-item">
                    <div class="product-image">
                        <img src="{{ item.img }}" alt="Product Image">
                    </div>
                    <div class="product-details">
                        <h2>{{ item.name }}</h2>
                        <p>Color: OLIVE/MULTI</p>
                        <p>Size: S</p>
                        <p>In Stock</p>
                    </div>
                    <div class="product-pricing">
                        <div class="price-label">
                            <span>Each:</span>
                            <span class="each-price">{{ item.price }}</span>
                        </div>
                        <div class="quantity">
                            <label for="quantity">Qty:</label>
                            <select id="quantity" name="quantity" class="quantity_class" data-product-id="{{ item.id }}">
                                {% for i in "x"|rjust:"10" %}
                                <option value="{{ forloop.counter }}" {% if item.qte == forloop.counter %}selected{% endif %}>
                                    {{ forloop.counter }}
                                </option>
                            {% endfor %}
                                
                                 </select>
                        </div>
                        <div class="total-price">
                            <span>$39</span>
                        </div>
                    </div>
                    <div class="actions">
                        <a href="#">Edit</a> |
                        <a href="#">Remove</a> |
                        <a href="#">Move to Wishlist</a> |
                        <a href="#">Save for Later</a>
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        
            <!-- Checkout Section on the Right -->
            <div class="cart-checkout">
                <div class="promo-code">
                    <input type="text" placeholder="Promo Code">
                    <button>Submit</button>
                </div>
                <div class="order-summary">
                    <p>Shipping cost: TBD</p>
                    <p>Discount: - $0</p>
                    <p>Tax: TBD</p>
                    <p><strong>Estimated Total: $39.99</strong></p>
                </div>
                <button class="checkout-btn">Checkout</button>
            </div>
        </div>
        
<script>

    // Listen for changes on any select element with class 'quantity-input'
    $('.quantity_class').on('change', function() {
        var $select = $(this);
        var newQuantity = $select.val();
        var productId = $select.data('product-id');  // Assuming you add a data-product-id attribute to your select

        // Prepare the data to be sent
        var data = {
            product_id: productId,
            qte: newQuantity
        };

        // Send the AJAX request
        $.ajax({
            url: '{% url "myapp:update" %}',  // Replace with your actual endpoint
            type: 'POST',
            data: data,
            action: 'update', 
            success: function(response){
                
            },
            error: function(xhr, status, error) {
                console.error('Error updating quantity:', error);
            }
        });
    });

    // Function to update the total price in the UI
    function updateTotalPrice(newTotal) {
        $('.total-price').text('â‚¬ ' + newTotal.toFixed(2));
    }

</script>
    {% include "footer.html" %}
</body>
</html>